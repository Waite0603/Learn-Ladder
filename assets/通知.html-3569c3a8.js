import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as e,o as c,c as l,a as n,b as s,d as t,e as p}from"./app-4df96303.js";const i={},u=p('<h2 id="基础通知" tabindex="-1"><a class="header-anchor" href="#基础通知" aria-hidden="true">#</a> 基础通知</h2><p>https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V3/notification-guidelines-0000001281360946-V3</p><figure><img src="https://qiniu.waite.wang/202405062126248.png" alt="image-20240506212640352" tabindex="0" loading="lazy"><figcaption>image-20240506212640352</figcaption></figure><figure><img src="https://qiniu.waite.wang/202405062127967.png" alt="image-20240506212749996" tabindex="0" loading="lazy"><figcaption>image-20240506212749996</figcaption></figure><p>https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3</p><table><thead><tr><th>名称</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td>NOTIFICATION_CONTENT_BASIC_TEXT</td><td>ContentType</td><td>普通类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_LONG_TEXT</td><td>ContentType</td><td>长文本类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_PICTURE</td><td>ContentType</td><td>图片类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_CONVERSATION</td><td>ContentType</td><td>社交类型通知。</td></tr><tr><td>NOTIFICATION_CONTENT_MULTILINE</td><td>ContentType</td><td>多行文本类型通知。</td></tr></tbody></table><p><strong>系统能力</strong>：以下各项对应的系统能力均为SystemCapability.Notification.Notification</p>',7),k=n("thead",null,[n("tr",null,[n("th",null,"名称"),n("th",null,"可读"),n("th",null,"可写"),n("th",null,"类型"),n("th",null,"必填"),n("th",null,"描述")])],-1),r=n("td",null,"content",-1),d=n("td",null,"是",-1),v=n("td",null,"是",-1),m={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationcontent",target:"_blank",rel:"noopener noreferrer"},b=n("td",null,"是",-1),g=n("td",null,"通知内容。",-1),f=n("tr",null,[n("td",null,"id"),n("td",null,"是"),n("td",null,"是"),n("td",null,"number"),n("td",null,"否"),n("td",null,"通知ID。")],-1),h=n("td",null,"slotType",-1),w=n("td",null,"是",-1),y=n("td",null,"是",-1),_={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__slottype",target:"_blank",rel:"noopener noreferrer"},T=n("td",null,"否",-1),N=n("td",null,"通道类型。",-1),I=n("tr",null,[n("td",null,"isOngoing"),n("td",null,"是"),n("td",null,"是"),n("td",null,"boolean"),n("td",null,"否"),n("td",null,"是否进行时通知。")],-1),x=n("tr",null,[n("td",null,"isUnremovable"),n("td",null,"是"),n("td",null,"是"),n("td",null,"boolean"),n("td",null,"否"),n("td",null,"是否可移除。")],-1),C=n("tr",null,[n("td",null,"deliveryTime"),n("td",null,"是"),n("td",null,"是"),n("td",null,"number"),n("td",null,"否"),n("td",null,"通知发送时间。")],-1),A=n("tr",null,[n("td",null,"tapDismissed"),n("td",null,"是"),n("td",null,"是"),n("td",null,"boolean"),n("td",null,"否"),n("td",null,"通知是否自动清除。")],-1),O=n("tr",null,[n("td",null,"autoDeletedTime"),n("td",null,"是"),n("td",null,"是"),n("td",null,"number"),n("td",null,"否"),n("td",null,"自动清除的时间。")],-1),S=n("tr",null,[n("td",null,"wantAgent"),n("td",null,"是"),n("td",null,"是"),n("td",null,"WantAgent"),n("td",null,"否"),n("td",null,"点击跳转的WantAgent。")],-1),V=n("tr",null,[n("td",null,"extraInfo"),n("td",null,"是"),n("td",null,"是"),n("td",{"[key:":"","string]:":"",any:""}),n("td",null,"否"),n("td",null,"扩展参数。")],-1),E=n("tr",null,[n("td",null,"color"),n("td",null,"是"),n("td",null,"是"),n("td",null,"number"),n("td",null,"否"),n("td",null,"通知背景颜色。")],-1),B=n("tr",null,[n("td",null,"colorEnabled"),n("td",null,"是"),n("td",null,"是"),n("td",null,"boolean"),n("td",null,"否"),n("td",null,"通知背景颜色是否使能。")],-1),q=n("tr",null,[n("td",null,"isAlertOnce"),n("td",null,"是"),n("td",null,"是"),n("td",null,"boolean"),n("td",null,"否"),n("td",null,"设置是否仅有一次此通知警报。")],-1),P=n("tr",null,[n("td",null,"isStopwatch"),n("td",null,"是"),n("td",null,"是"),n("td",null,"boolean"),n("td",null,"否"),n("td",null,"是否显示已用时间。")],-1),D=n("tr",null,[n("td",null,"isCountDown"),n("td",null,"是"),n("td",null,"是"),n("td",null,"boolean"),n("td",null,"否"),n("td",null,"是否显示倒计时时间。")],-1),F=n("tr",null,[n("td",null,"isFloatingIcon"),n("td",null,"是"),n("td",null,"是"),n("td",null,"boolean"),n("td",null,"否"),n("td",null,"是否显示状态栏图标。")],-1),M=n("tr",null,[n("td",null,"label"),n("td",null,"是"),n("td",null,"是"),n("td",null,"string"),n("td",null,"否"),n("td",null,"通知标签。")],-1),L=n("tr",null,[n("td",null,"badgeIconStyle"),n("td",null,"是"),n("td",null,"是"),n("td",null,"number"),n("td",null,"否"),n("td",null,"通知角标类型。")],-1),R=n("tr",null,[n("td",null,"showDeliveryTime"),n("td",null,"是"),n("td",null,"是"),n("td",null,"boolean"),n("td",null,"否"),n("td",null,"是否显示分发时间。")],-1),W=n("td",null,"actionButtons",-1),U=n("td",null,"是",-1),G=n("td",null,"是",-1),j={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationactionbutton",target:"_blank",rel:"noopener noreferrer"},z=n("td",null,"否",-1),H=n("td",null,"通知按钮，最多两个按钮。",-1),$=n("tr",null,[n("td",null,"smallIcon"),n("td",null,"是"),n("td",null,"是"),n("td",null,"PixelMap"),n("td",null,"否"),n("td",null,"通知小图标。")],-1),X=n("tr",null,[n("td",null,"largeIcon"),n("td",null,"是"),n("td",null,"是"),n("td",null,"PixelMap"),n("td",null,"否"),n("td",null,"通知大图标。")],-1),Z=n("tr",null,[n("td",null,"creatorBundleName"),n("td",null,"是"),n("td",null,"否"),n("td",null,"string"),n("td",null,"否"),n("td",null,"创建通知的包名。")],-1),J=n("tr",null,[n("td",null,"creatorUid"),n("td",null,"是"),n("td",null,"否"),n("td",null,"number"),n("td",null,"否"),n("td",null,"创建通知的UID。")],-1),Y=n("tr",null,[n("td",null,"creatorPid"),n("td",null,"是"),n("td",null,"否"),n("td",null,"number"),n("td",null,"否"),n("td",null,"创建通知的PID。")],-1),K=n("tr",null,[n("td",null,"creatorUserId8+"),n("td",null,"是"),n("td",null,"否"),n("td",null,"number"),n("td",null,"否"),n("td",null,"创建通知的UserId。")],-1),Q=n("tr",null,[n("td",null,"hashCode"),n("td",null,"是"),n("td",null,"否"),n("td",null,"string"),n("td",null,"否"),n("td",null,"通知唯一标识。")],-1),nn=n("tr",null,[n("td",null,"groupName8+"),n("td",null,"是"),n("td",null,"是"),n("td",null,"string"),n("td",null,"否"),n("td",null,"组通知名称。")],-1),sn=n("td",null,"template8+",-1),an=n("td",null,"是",-1),tn=n("td",null,"是",-1),pn={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationtemplate8",target:"_blank",rel:"noopener noreferrer"},on=n("td",null,"否",-1),en=n("td",null,"通知模板。",-1),cn=n("td",null,"distributedOption8+",-1),ln=n("td",null,"是",-1),un=n("td",null,"是",-1),kn={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__distributedoptions8",target:"_blank",rel:"noopener noreferrer"},rn=n("td",null,"否",-1),dn=n("td",null,"分布式通知的选项。",-1),vn=n("td",null,"notificationFlags8+",-1),mn=n("td",null,"是",-1),bn=n("td",null,"否",-1),gn={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V3/js-apis-notification-0000001333321097-V3#ZH-CN_TOPIC_0000001333321097__notificationflags8",target:"_blank",rel:"noopener noreferrer"},fn=n("td",null,"否",-1),hn=n("td",null,"获取NotificationFlags。",-1),wn=p(`<figure><img src="https://qiniu.waite.wang/202405062132587.png" alt="image-20240506213240105" tabindex="0" loading="lazy"><figcaption>image-20240506213240105</figcaption></figure><figure><img src="https://qiniu.waite.wang/202405062234933.png" alt="image-20240506223426686" tabindex="0" loading="lazy"><figcaption>image-20240506223426686</figcaption></figure><figure><img src="https://qiniu.waite.wang/202405062234804.png" alt="image-20240506223438334" tabindex="0" loading="lazy"><figcaption>image-20240506223438334</figcaption></figure><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> notify <span class="token keyword">from</span> <span class="token string">&#39;@ohos.notificationManager&#39;</span>
<span class="token keyword">import</span> image <span class="token keyword">from</span> <span class="token string">&#39;@ohos.multimedia.image&#39;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Entry</span></span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span>
struct Index <span class="token punctuation">{</span>
  <span class="token comment">// 全局任务 id</span>
  idx<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">100</span>
  <span class="token comment">// 图像</span>
  pixel<span class="token operator">:</span> PixelMap

  <span class="token keyword">async</span> <span class="token function">aboutToAppear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取资源管理器</span>
    <span class="token keyword">let</span> rm <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resourceManager
    <span class="token comment">// 读取图片</span>
    <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">await</span> rm<span class="token punctuation">.</span><span class="token function">getMediaContent</span><span class="token punctuation">(</span><span class="token function">$r</span><span class="token punctuation">(</span><span class="token string">&#39;app.media.watchGT4&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建 PixelMap</span>
    image<span class="token punctuation">.</span><span class="token function">createImageSource</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createPixelMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>value <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pixel <span class="token operator">=</span> value<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>reason <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">{</span> space<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">Button</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">发送normalText通知</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publishNormalTextNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">Button</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">发送longText通知</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publishLongTextNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">Button</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">发送multiLine通知</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publishMultiLineNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">Button</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">发送Picture通知</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publishPictureNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">publishNormalTextNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> request<span class="token operator">:</span> notify<span class="token punctuation">.</span>NotificationRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idx<span class="token operator">++</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token punctuation">{</span>
        contentType<span class="token operator">:</span> notify<span class="token punctuation">.</span>ContentType<span class="token punctuation">.</span><span class="token constant">NOTIFICATION_CONTENT_BASIC_TEXT</span><span class="token punctuation">,</span>
        normal<span class="token operator">:</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token string">&#39;通知标题&#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idx<span class="token punctuation">,</span>
          text<span class="token operator">:</span> <span class="token string">&#39;通知内容详情&#39;</span><span class="token punctuation">,</span>
          additionalText<span class="token operator">:</span> <span class="token string">&#39;通知附加内容&#39;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      showDeliveryTime<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      deliveryTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      groupName<span class="token operator">:</span> <span class="token string">&#39;wechat&#39;</span><span class="token punctuation">,</span>
      slotType<span class="token operator">:</span> notify<span class="token punctuation">.</span>SlotType<span class="token punctuation">.</span><span class="token constant">SOCIAL_COMMUNICATION</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">publishLongTextNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> request<span class="token operator">:</span> notify<span class="token punctuation">.</span>NotificationRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idx<span class="token operator">++</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token punctuation">{</span>
        contentType<span class="token operator">:</span> notify<span class="token punctuation">.</span>ContentType<span class="token punctuation">.</span><span class="token constant">NOTIFICATION_CONTENT_LONG_TEXT</span><span class="token punctuation">,</span>
        longText<span class="token operator">:</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token string">&#39;通知标题&#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idx<span class="token punctuation">,</span>
          text<span class="token operator">:</span> <span class="token string">&#39;通知内容详情&#39;</span><span class="token punctuation">,</span>
          additionalText<span class="token operator">:</span> <span class="token string">&#39;通知附加内容&#39;</span><span class="token punctuation">,</span>
          longText<span class="token operator">:</span> <span class="token string">&#39;通知中的长文本，我很长，我很长，我很长，我很长，我很长，我很长，我很长&#39;</span><span class="token punctuation">,</span>
          briefText<span class="token operator">:</span> <span class="token string">&#39;通知概要和总结&#39;</span><span class="token punctuation">,</span>
          expandedTitle<span class="token operator">:</span> <span class="token string">&#39;通知展开时的标题&#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idx
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">publishMultiLineNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> request<span class="token operator">:</span> notify<span class="token punctuation">.</span>NotificationRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idx<span class="token operator">++</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token punctuation">{</span>
        contentType<span class="token operator">:</span> notify<span class="token punctuation">.</span>ContentType<span class="token punctuation">.</span><span class="token constant">NOTIFICATION_CONTENT_MULTILINE</span><span class="token punctuation">,</span>
        multiLine<span class="token operator">:</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token string">&#39;通知标题&#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idx<span class="token punctuation">,</span>
          text<span class="token operator">:</span> <span class="token string">&#39;通知内容详情&#39;</span><span class="token punctuation">,</span>
          additionalText<span class="token operator">:</span> <span class="token string">&#39;通知附加内容&#39;</span><span class="token punctuation">,</span>
          briefText<span class="token operator">:</span> <span class="token string">&#39;通知概要和总结&#39;</span><span class="token punctuation">,</span>
          longTitle<span class="token operator">:</span> <span class="token string">&#39;展开时的标题，我很宽，我很宽，我很宽&#39;</span><span class="token punctuation">,</span>
          lines<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&#39;第一行&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&#39;第二行&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&#39;第三行&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&#39;第四行&#39;</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">publishPictureNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> request<span class="token operator">:</span> notify<span class="token punctuation">.</span>NotificationRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idx<span class="token operator">++</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token punctuation">{</span>
        contentType<span class="token operator">:</span> notify<span class="token punctuation">.</span>ContentType<span class="token punctuation">.</span><span class="token constant">NOTIFICATION_CONTENT_PICTURE</span><span class="token punctuation">,</span>
        picture<span class="token operator">:</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token string">&#39;通知标题&#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idx<span class="token punctuation">,</span>
          text<span class="token operator">:</span> <span class="token string">&#39;通知内容详情&#39;</span><span class="token punctuation">,</span>
          additionalText<span class="token operator">:</span> <span class="token string">&#39;通知附加内容&#39;</span><span class="token punctuation">,</span>
          briefText<span class="token operator">:</span> <span class="token string">&#39;通知概要和总结&#39;</span><span class="token punctuation">,</span>
          expandedTitle<span class="token operator">:</span> <span class="token string">&#39;展开后标题&#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idx<span class="token punctuation">,</span>
          picture<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pixel
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">publish</span><span class="token punctuation">(</span>request<span class="token operator">:</span> notify<span class="token punctuation">.</span>NotificationRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    notify<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;notify test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;发送通知成功&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>reason <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;notify test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;发送通知失败&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="进度条通知" tabindex="-1"><a class="header-anchor" href="#进度条通知" aria-hidden="true">#</a> 进度条通知</h2><figure><img src="https://qiniu.waite.wang/202405070825635.png" alt="image-20240507082507831" tabindex="0" loading="lazy"><figcaption>image-20240507082507831</figcaption></figure><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> Notification <span class="token keyword">from</span> <span class="token string">&#39;@ohos.notificationManager&#39;</span>
<span class="token keyword">import</span> wantAgent<span class="token punctuation">,</span> <span class="token punctuation">{</span> WantAgent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@ohos.app.ability.wantAgent&#39;</span>
<span class="token keyword">import</span> promptAction <span class="token keyword">from</span> <span class="token string">&#39;@ohos.promptAction&#39;</span>
<span class="token keyword">import</span> Prompt <span class="token keyword">from</span> <span class="token string">&#39;@system.prompt&#39;</span>

<span class="token keyword">enum</span> DownloadState <span class="token punctuation">{</span>
  <span class="token constant">NOT_BEGIN</span> <span class="token operator">=</span> <span class="token string">&#39;未开始&#39;</span><span class="token punctuation">,</span>
  <span class="token constant">DOWNLOADING</span> <span class="token operator">=</span> <span class="token string">&#39;下载中&#39;</span><span class="token punctuation">,</span>
  <span class="token constant">PAUSE</span> <span class="token operator">=</span> <span class="token string">&#39;已暂停&#39;</span><span class="token punctuation">,</span>
  <span class="token constant">FINISHED</span> <span class="token operator">=</span> <span class="token string">&#39;已完成&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Entry</span></span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span>
struct Index <span class="token punctuation">{</span>
  <span class="token comment">// 下载进度</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">State</span></span> progressValue<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span>
  progressMaxValue<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">100</span>
  <span class="token comment">// 任务状态</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">State</span></span> state<span class="token operator">:</span> DownloadState <span class="token operator">=</span> DownloadState<span class="token punctuation">.</span><span class="token constant">NOT_BEGIN</span>

  <span class="token comment">// 下载的文件名</span>
  filename<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;圣诞星.mp4&#39;</span>

  <span class="token comment">// 模拟下载的任务的id</span>
  taskId<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>

  <span class="token comment">// 通知id</span>
  notificationId<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">999</span>
  isSupport<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span>
  wantAgentInstance<span class="token operator">:</span> WantAgent

  <span class="token keyword">async</span> <span class="token function">aboutToAppear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.判断当前系统是否支持进度条模板</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isSupport <span class="token operator">=</span> <span class="token keyword">await</span> Notification<span class="token punctuation">.</span><span class="token function">isSupportTemplate</span><span class="token punctuation">(</span><span class="token string">&#39;downloadTemplate&#39;</span><span class="token punctuation">)</span>
    <span class="token comment">// 2.创建拉取当前应用的行为意图</span>
    <span class="token comment">// 2.1.创建wantInfo信息</span>
    <span class="token keyword">let</span> wantInfo<span class="token operator">:</span> wantAgent<span class="token punctuation">.</span>WantAgentInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
      wants<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          bundleName<span class="token operator">:</span> <span class="token string">&#39;com.example.myapplication&#39;</span><span class="token punctuation">,</span>
          abilityName<span class="token operator">:</span> <span class="token string">&#39;EntryAbility&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      requestCode<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      operationType<span class="token operator">:</span> wantAgent<span class="token punctuation">.</span>OperationType<span class="token punctuation">.</span><span class="token constant">START_ABILITY</span><span class="token punctuation">,</span>
      wantAgentFlags<span class="token operator">:</span> <span class="token punctuation">[</span>wantAgent<span class="token punctuation">.</span>WantAgentFlags<span class="token punctuation">.</span><span class="token constant">CONSTANT_FLAG</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2.2.创建wantAgent实例</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>wantAgentInstance <span class="token operator">=</span> <span class="token keyword">await</span> wantAgent<span class="token punctuation">.</span><span class="token function">getWantAgent</span><span class="token punctuation">(</span>wantInfo<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">{</span> space<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">Image</span><span class="token punctuation">(</span><span class="token function">$r</span><span class="token punctuation">(</span><span class="token string">&#39;app.media.ic_files_video&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
      <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">{</span> space<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span>
          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>progressValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fontColor</span><span class="token punctuation">(</span><span class="token string">&#39;#c1c2c1&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">justifyContent</span><span class="token punctuation">(</span>FlexAlign<span class="token punctuation">.</span>SpaceBetween<span class="token punctuation">)</span>

        <span class="token function">Progress</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>progressValue<span class="token punctuation">,</span>
          total<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>progressMaxValue<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">{</span> space<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>progressValue <span class="token operator">*</span> <span class="token number">0.43</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">MB</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">fontSize</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fontColor</span><span class="token punctuation">(</span><span class="token string">&#39;#c1c2c1&#39;</span><span class="token punctuation">)</span>
          <span class="token function">Blank</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> DownloadState<span class="token punctuation">.</span><span class="token constant">NOT_BEGIN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">&#39;开始&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downloadButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> DownloadState<span class="token punctuation">.</span><span class="token constant">DOWNLOADING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">&#39;取消&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downloadButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">backgroundColor</span><span class="token punctuation">(</span><span class="token string">&#39;#d1d2d3&#39;</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">&#39;暂停&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downloadButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> DownloadState<span class="token punctuation">.</span><span class="token constant">PAUSE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">&#39;取消&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downloadButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">backgroundColor</span><span class="token punctuation">(</span><span class="token string">&#39;#d1d2d3&#39;</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">&#39;继续&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downloadButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">&#39;打开&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downloadButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">.</span><span class="token function">layoutWeight</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">borderRadius</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">backgroundColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 取消定时任务</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>taskId <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>taskId <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>notificationId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 清理下载任务进度</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>progressValue <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// 标记任务状态：未开始</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> DownloadState<span class="token punctuation">.</span><span class="token constant">NOT_BEGIN</span>
    <span class="token comment">// 取消通知</span>
    Notification<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>notificationId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ssssss&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 清理旧任务</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>taskId <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 开启定时任务，模拟下载</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>taskId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 判断任务进度是否达到100</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>progressValue <span class="token operator">&gt;=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 任务完成了，应该取消定时任务</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>taskId<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>taskId <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token comment">// 并且标记任务状态为已完成</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> DownloadState<span class="token punctuation">.</span><span class="token constant">FINISHED</span>
        <span class="token comment">// 发送通知</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publishProgressNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 模拟任务进度变更</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>progressValue <span class="token operator">+=</span> <span class="token number">2</span>
      <span class="token comment">// 发送通知</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publishProgressNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token comment">// 标记任务状态：下载中</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> DownloadState<span class="token punctuation">.</span><span class="token constant">DOWNLOADING</span>
  <span class="token punctuation">}</span>

  <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 取消定时任务</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>taskId <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>taskId <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 标记任务状态：已暂停</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> DownloadState<span class="token punctuation">.</span><span class="token constant">PAUSE</span>
    <span class="token comment">// 发送通知</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publishProgressNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    promptAction<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">&#39;功能未实现&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">publishProgressNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> isSupportTpl<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> Notification<span class="token punctuation">.</span><span class="token function">isSupportTemplate</span><span class="token punctuation">(</span><span class="token string">&#39;downloadTemplate&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      isSupportTpl <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Prompt<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">判断是否支持进度条模板时报错,error[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
        duration<span class="token operator">:</span> <span class="token number">2000</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isSupportTpl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 构造模板</span>
      <span class="token keyword">let</span> template <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&#39;downloadTemplate&#39;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          progressValue<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>progressValue<span class="token punctuation">,</span> <span class="token comment">// 当前进度值</span>
          progressMaxValue<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>progressMaxValue <span class="token comment">// 最大进度值</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> notificationRequest<span class="token operator">:</span> Notification<span class="token punctuation">.</span>NotificationRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>notificationId<span class="token punctuation">,</span>
        content<span class="token operator">:</span> <span class="token punctuation">{</span>
          contentType<span class="token operator">:</span> Notification<span class="token punctuation">.</span>ContentType<span class="token punctuation">.</span><span class="token constant">NOTIFICATION_CONTENT_BASIC_TEXT</span><span class="token punctuation">,</span>
          normal<span class="token operator">:</span> <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>filename <span class="token operator">+</span> <span class="token string">&#39;:  &#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span>
            text<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
            additionalText<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>progressValue <span class="token operator">+</span> <span class="token string">&#39;%&#39;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        template<span class="token operator">:</span> template
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">// 发布通知</span>
      Notification<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>notificationRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        Prompt<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">发布通知成功！</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
          duration<span class="token operator">:</span> <span class="token number">2000</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        Prompt<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">发布通知失败,error[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
          duration<span class="token operator">:</span> <span class="token number">2000</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      Prompt<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        message<span class="token operator">:</span> <span class="token string">&#39;不支持downloadTemplate进度条通知模板&#39;</span><span class="token punctuation">,</span>
        duration<span class="token operator">:</span> <span class="token number">2000</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">publishDownloadNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.判断当前系统是否支持进度条模板</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isSupport<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 当前系统不支持进度条模板</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;not support&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2.准备进度条模板的参数</span>
    <span class="token keyword">let</span> template <span class="token operator">=</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&#39;downloadTemplate&#39;</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span>
        progressValue<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>progressValue<span class="token punctuation">,</span>
        progressMaxValue<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>progressMaxValue
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> request<span class="token operator">:</span> Notification<span class="token punctuation">.</span>NotificationRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>notificationId<span class="token punctuation">,</span>
      template<span class="token operator">:</span> template<span class="token punctuation">,</span>
      wantAgent<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wantAgentInstance<span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token punctuation">{</span>
        contentType<span class="token operator">:</span> Notification<span class="token punctuation">.</span>ContentType<span class="token punctuation">.</span><span class="token constant">NOTIFICATION_CONTENT_BASIC_TEXT</span><span class="token punctuation">,</span>
        normal<span class="token operator">:</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>filename <span class="token operator">+</span> <span class="token string">&#39;:  &#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span>
          text<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
          additionalText<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>progressValue <span class="token operator">+</span> <span class="token string">&#39;%&#39;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3.发送通知</span>
    Notification<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;通知发送成功&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>reason <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;通知发送失败！&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@<span class="token function">Extend</span><span class="token punctuation">(</span>Button<span class="token punctuation">)</span> <span class="token keyword">function</span> <span class="token function">downloadButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fontSize</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="通知意图" tabindex="-1"><a class="header-anchor" href="#通知意图" aria-hidden="true">#</a> 通知意图</h2><blockquote><p>具体参数看官方文档</p></blockquote><p>https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V2/js-apis-app-ability-wantagent-0000001493424324-V2</p><p>​ <img src="https://qiniu.waite.wang/202405070915916.png" alt="image-20240507091512134" loading="lazy"></p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token keyword">async</span> <span class="token function">aboutToAppear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.判断当前系统是否支持进度条模板</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>isSupport <span class="token operator">=</span> <span class="token keyword">await</span> Notification<span class="token punctuation">.</span><span class="token function">isSupportTemplate</span><span class="token punctuation">(</span><span class="token string">&#39;downloadTemplate&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// 2.创建拉取当前应用的行为意图</span>
  <span class="token comment">// 2.1.创建wantInfo信息</span>
  <span class="token keyword">let</span> wantInfo<span class="token operator">:</span> wantAgent<span class="token punctuation">.</span>WantAgentInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    wants<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        bundleName<span class="token operator">:</span> <span class="token string">&#39;com.example.learn_2&#39;</span><span class="token punctuation">,</span>
        abilityName<span class="token operator">:</span> <span class="token string">&#39;EntryAbility&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    requestCode<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    operationType<span class="token operator">:</span> wantAgent<span class="token punctuation">.</span>OperationType<span class="token punctuation">.</span><span class="token constant">START_ABILITY</span><span class="token punctuation">,</span>
    wantAgentFlags<span class="token operator">:</span> <span class="token punctuation">[</span>wantAgent<span class="token punctuation">.</span>WantAgentFlags<span class="token punctuation">.</span><span class="token constant">CONSTANT_FLAG</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 2.2.创建wantAgent实例</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>wantAgentInstance <span class="token operator">=</span> <span class="token keyword">await</span> wantAgent<span class="token punctuation">.</span><span class="token function">getWantAgent</span><span class="token punctuation">(</span>wantInfo<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token keyword">async</span> <span class="token function">publishProgressNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> isSupportTpl<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> Notification<span class="token punctuation">.</span><span class="token function">isSupportTemplate</span><span class="token punctuation">(</span><span class="token string">&#39;downloadTemplate&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    isSupportTpl <span class="token operator">=</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    Prompt<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">判断是否支持进度条模板时报错,error[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
      duration<span class="token operator">:</span> <span class="token number">2000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isSupportTpl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 构造模板</span>
    <span class="token keyword">let</span> template <span class="token operator">=</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&#39;downloadTemplate&#39;</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span>
        progressValue<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>progressValue<span class="token punctuation">,</span> <span class="token comment">// 当前进度值</span>
        progressMaxValue<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>progressMaxValue <span class="token comment">// 最大进度值</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> notificationRequest<span class="token operator">:</span> Notification<span class="token punctuation">.</span>NotificationRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>notificationId<span class="token punctuation">,</span>
      wantAgent<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wantAgentInstance<span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token punctuation">{</span>
        contentType<span class="token operator">:</span> Notification<span class="token punctuation">.</span>ContentType<span class="token punctuation">.</span><span class="token constant">NOTIFICATION_CONTENT_BASIC_TEXT</span><span class="token punctuation">,</span>
        normal<span class="token operator">:</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>filename <span class="token operator">+</span> <span class="token string">&#39;:  &#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span>
          text<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
          additionalText<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>progressValue <span class="token operator">+</span> <span class="token string">&#39;%&#39;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      template<span class="token operator">:</span> template
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 发布通知</span>
    Notification<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>notificationRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Prompt<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">发布通知成功！</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
        duration<span class="token operator">:</span> <span class="token number">2000</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Prompt<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">发布通知失败,error[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
        duration<span class="token operator">:</span> <span class="token number">2000</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    Prompt<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">&#39;不支持downloadTemplate进度条通知模板&#39;</span><span class="token punctuation">,</span>
      duration<span class="token operator">:</span> <span class="token number">2000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,13);function yn(_n,Tn){const a=e("ExternalLinkIcon");return c(),l("div",null,[u,n("table",null,[k,n("tbody",null,[n("tr",null,[r,d,v,n("td",null,[n("a",m,[s("NotificationContent"),t(a)])]),b,g]),f,n("tr",null,[h,w,y,n("td",null,[n("a",_,[s("SlotType"),t(a)])]),T,N]),I,x,C,A,O,S,V,E,B,q,P,D,F,M,L,R,n("tr",null,[W,U,G,n("td",null,[s("Array<"),n("a",j,[s("NotificationActionButton"),t(a)]),s(">")]),z,H]),$,X,Z,J,Y,K,Q,nn,n("tr",null,[sn,an,tn,n("td",null,[n("a",pn,[s("NotificationTemplate"),t(a)])]),on,en]),n("tr",null,[cn,ln,un,n("td",null,[n("a",kn,[s("DistributedOptions"),t(a)])]),rn,dn]),n("tr",null,[vn,mn,bn,n("td",null,[n("a",gn,[s("NotificationFlags"),t(a)])]),fn,hn])])]),wn])}const xn=o(i,[["render",yn],["__file","通知.html.vue"]]);export{xn as default};
