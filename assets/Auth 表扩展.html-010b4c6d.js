import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as t,c as l,a as s,b as n,d as c,e as a}from"./app-4df96303.js";const r={},i=a(`<h2 id="auth模块的介绍" tabindex="-1"><a class="header-anchor" href="#auth模块的介绍" aria-hidden="true">#</a> auth模块的介绍</h2><ul><li><p>1、导包</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> auth
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>2、默认使用<code>auth_user</code>表来存储用户数据</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># 默认用户表是位置</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------+</span>
<span class="token operator">|</span> Tables_in_django_rest01    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------+</span>
<span class="token operator">|</span> auth_group                 <span class="token operator">|</span>
<span class="token operator">|</span> auth_group_permissions     <span class="token operator">|</span>
<span class="token operator">|</span> auth_permission            <span class="token operator">|</span>
<span class="token operator">|</span> auth_user                  <span class="token operator">|</span>
<span class="token operator">|</span> auth_user_groups           <span class="token operator">|</span>
<span class="token operator">|</span> auth_user_user_permissions <span class="token operator">|</span>
<span class="token operator">|</span> django_admin_log           <span class="token operator">|</span>
<span class="token operator">|</span> django_content_type        <span class="token operator">|</span>
<span class="token operator">|</span> django_migrations          <span class="token operator">|</span>
<span class="token operator">|</span> django_session             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------+</span>
<span class="token number">10</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

auth_group: 存储用户组信息。每个用户组可以有多个权限。
auth_group_permissions: 存储用户组和权限的关联关系。一个用户组可以有多个权限。
auth_permission: 存储系统中定义的所有权限。权限通常与特定的模型和操作相关联。
auth_user: 存储用户账户信息，如用户名、密码、电子邮件等。
auth_user_groups: 存储用户和用户组的关联关系。一个用户可以属于多个用户组。
auth_user_user_permissions: 存储用户特定的权限，这些权限不会通过用户组继承。
django_admin_log: 存储管理站点的操作日志，如添加、更改或删除记录。
django_content_type: 存储Django中所有模型的元数据，包括app_label和model字段，用于确定对象类型。
django_migrations: 存储关于应用的迁移历史信息，包括迁移的名称和应用时间。
django_session: 存储会话数据，用于支持Django的会话框架。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">desc</span> auth_user<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+------+-----+---------+----------------+</span>
<span class="token operator">|</span> Field        <span class="token operator">|</span> <span class="token keyword">Type</span>         <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+------+-----+---------+----------------+</span>
<span class="token operator">|</span> id           <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>      <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token keyword">auto_increment</span> <span class="token operator">|</span>
<span class="token operator">|</span> password     <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> last_login   <span class="token operator">|</span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> is_superuser <span class="token operator">|</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> username     <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> UNI <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> first_name   <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>  <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> last_name    <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> email        <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">254</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> is_staff     <span class="token operator">|</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> is_active    <span class="token operator">|</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> date_joined  <span class="token operator">|</span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------------+------+-----+---------+----------------+</span>
<span class="token number">11</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="常用方法" tabindex="-1"><a class="header-anchor" href="#常用方法" aria-hidden="true">#</a> 常用方法</h3><ul><li><p>1、<code>authenticate()</code>用来校验用户名及密码</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> authenticate<span class="token punctuation">,</span> login<span class="token punctuation">,</span> logout
<span class="token comment"># 如果校验成功就返回当前用户,否则就返回None</span>
user <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>2、<code>login(HttpRequest, user)</code>用户用户登录,使用这个登录方式会生成相关的<code>session</code></p></li><li><p>3、<code>logout(request)</code>退出操作,清除相关的<code>session</code></p></li><li><p>4、<code>is_authenticated()</code>用来判断当前请求是否通过认证</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span> <span class="token keyword">not</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;%s?next=%s&#39;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>settings<span class="token punctuation">.</span>LOGIN_URL<span class="token punctuation">,</span> request<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>5、<code>login_requierd()</code>必须登录的装饰器</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> login_required
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>若用户没有登录，则会跳转到<code>django</code>默认的 登录<code>URL &#39;/accounts/login/ &#39;</code> 并传递当前访问<code>url</code>的绝对路径 (登陆成功后，会重定向到该路径)。如果需要自定义登录的URL，则需要在<code>settings.py</code>文件中通过<code>LOGIN_URL</code>进行修改。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>LOGIN_URL <span class="token operator">=</span> <span class="token string">&#39;/login/&#39;</span>  <span class="token comment"># 这里配置成你项目登录页面的路由</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>6、<code>create_user()</code>创建普通用户的</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user（username<span class="token operator">=</span><span class="token string">&#39;用户名&#39;</span><span class="token punctuation">,</span>password<span class="token operator">=</span><span class="token string">&#39;密码&#39;</span><span class="token punctuation">,</span>email<span class="token operator">=</span><span class="token string">&#39;邮箱&#39;</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>）
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>7、<code>create_superuser()</code>创建超级用户</p></li><li><p>8、<code>check_password(password)</code>检查密码是否正确(用户登录)</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>user<span class="token punctuation">.</span>check_password<span class="token punctuation">(</span><span class="token string">&#39;密码&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>9、<code>set_password(password)</code>设置密码(用于注册及修改密码)</p></li></ul><h2 id="扩展auth-user表" tabindex="-1"><a class="header-anchor" href="#扩展auth-user表" aria-hidden="true">#</a> 扩展auth_user表</h2><blockquote><p>默认你创建好了一个 app, 没有的话 <code>python manage.py startapp web</code></p></blockquote><ol><li>修改 <code>web/models</code></li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> AbstractUser


<span class="token keyword">class</span> <span class="token class-name">UserProfileModel</span><span class="token punctuation">(</span>AbstractUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">&quot;&quot;&quot;
  创建一个用户的模型
  &quot;&quot;&quot;</span>
  SEX_CHOICES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">&#39;male&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;男&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&#39;female&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;女&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
  phone <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;手机号&#39;</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  birthday <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;生日&#39;</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  sex <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> choices<span class="token operator">=</span>SEX_CHOICES<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;性别&#39;</span><span class="token punctuation">)</span>
  <span class="token comment"># 头像</span>
  avatar <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">&#39;default.jpg&#39;</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;头像&#39;</span><span class="token punctuation">)</span>
  address <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;地址&#39;</span><span class="token punctuation">)</span>

  <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    db_table <span class="token operator">=</span> <span class="token string">&#39;user_profile&#39;</span>
    verbose_name <span class="token operator">=</span> <span class="token string">&#39;用户信息&#39;</span>
    verbose_name_plural <span class="token operator">=</span> verbose_name

  <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 定义模型对象的显示信息</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>username
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9),u={start:"2"},d={href:"https://so.csdn.net/so/search?q=django&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"},k=a(`<div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># Custom user model</span>
AUTH_USER_MODEL <span class="token operator">=</span> <span class="token string">&#39;web.UserProfileModel&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>迁移模型到数据库</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ python manage.py makemigrations
$ python manage.py migrate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>创建超级用户，登录后台</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>python manage.py createsuperuser
Username: 
Email address:
Password:
Password (again):
Superuser created successfully.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>开启服务后进去一看，用户管理那一栏不见了</p><figure><img src="https://qiniu.waite.wang/202406142217114.png" alt="在这里插入图片描述" tabindex="0" loading="lazy"><figcaption>在这里插入图片描述</figcaption></figure><ol start="5"><li>在 <code>web/admin/py</code> 中注册一下就好了</li></ol><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
<span class="token keyword">from</span> web<span class="token punctuation">.</span>models <span class="token keyword">import</span> UserProfileModel

<span class="token comment"># Register your models here.</span>
admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>UserProfileModel<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://qiniu.waite.wang/202406142218031.png" alt="image-20240614221851196" tabindex="0" loading="lazy"><figcaption>image-20240614221851196</figcaption></figure><figure><img src="https://qiniu.waite.wang/202406142221851.png" alt="image-20240614222130109" tabindex="0" loading="lazy"><figcaption>image-20240614222130109</figcaption></figure>`,11);function m(v,b){const e=o("ExternalLinkIcon");return t(),l("div",null,[i,s("ol",u,[s("li",null,[n("修改settings.py, 添加设置让"),s("a",d,[n("django"),c(e)]),n("用 我们web下的modles.py中的user模型")])]),k])}const y=p(r,[["render",m],["__file","Auth 表扩展.html.vue"]]);export{y as default};
